template(name='home')
    img.ui.fluid.image.checkin_banner(src="{{c.url 'frontrange' width=1000 height=1000 crop='crop'}}")

    .ui.stackable.padded.grid
        .row
            if currentUser
                .six.wide.column     
                    +staff_tasks
                    +staff_checkin
                .four.wide.column     
                    +active_checkins
                .six.wide.column.smaller
                    +kiosk_settings
                .four.wide.column     
                    +latest_notes
                .four.wide.column     
                    +latest_requests
                .four.wide.column     
                    +latest_rentals
                .four.wide.column       
                    +guest_block
                .four.wide.column       
                    +admin
            .four.wide.column       
                .ui.header 
                    +i name='info'
                    | hours 7am-10pm
                a.ui.large.compact.button.zoomer(href="https://goo.gl/maps/Xzx6XiWAikcdMAso7" target="_window") 
                    +i name='marker'
                    |2959 Shadow Creek Dr, Boulder, CO 80303
                a.ui.large.compact.button.zoomer(href="tel:303-545-1787") 
                    +i name='phone'
                    |phone: (303) 545-1787
            
            .four.wide.column
                +latest_activity
            // if currentUser
            //     .four.wide.column
            //         +latest_checkins
            // .eight.wide.column
            //     +map_view
        // .one.column.row
        //     .column
        //         +staff
          
          
          
template(name='staff_checkin')          
    .ui.header
        +i name='shield'
        |staff
    .ui.small.header 
        |staff list 
    .ui.selection.animated.list
        each staff_users 
            a.item.fly_right.zoomer(href="/user/#{username}") 
                img.ui.avatar.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                |#{first_name} #{last_name}
                // |#{username}
    if checked_in
        .ui.button.clockout
            +i name='exit'
            |clock out
    else 
        .ui.button.clockin
            +i name='clock'
            |clock in
    .ui.inline.header 
        +i name='clock'
        |staff shifts
    if currentUser.admin_mode
        +add_user_button
        +call_method name='convert_units'
    // unless currentUser
    //     .ui.massive.icon.input.lookup_user
    //         i.search.icon
    //         input.search_user(type='text' placeholder='search user...')
    //     each checkedout_user_docs 
    //         a.ui.big.image.label.pick_user 
    //             img.ui.avatar.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
    //             |#{username}
    //             |#{building_number}: ##{unit_number}
    // if currentUser 
    //     if currentUser.checkedin 
    //         .ui.header currently checked in
    //         .ui.big.button.checkout
    //             +i name='exit'
    //             img.ui.avatar.image(src="{{c.url currentUser.image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
    //             |check out as #{currentUser.username}
    //     else 
    //         .ui.big.button.checkin 
    //             +i name='internal'
    //             img.ui.avatar.image(src="{{c.url currentUser.image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
    //             |check in as #{currentUser.username}



template(name='staff_tasks')          
    a.ui.header.zoomer.fly_right(href='/tasks')
        +i name='tasks'
        |#{staff_task_docs.count} staff tasks
    // .ui.icon.fluid.input 
    //     i.plus.icon
    //     input.task_quickadd(type='text' placeholder='quickadd')
    // +sort_direction_toggle
    // +session_set key='sort_key' value='_timestamp' label='when' icon='clock'
    // +session_set key='sort_key' value='building_number' label='building' icon='building'
    // +session_set key='sort_key' value='unit_number' label='unit' icon='room'
    // +session_set key='sort_key' value='complete' label='complete' icon='checkmark'
    // +session_set key='sort_key' value='_author_username' label='author' icon='user'

    .ui.divided.large.list.medscroll 
        each staff_task_docs 
            // a.item.fly_right(href="/task/#{_id}")
            .item
                .header
                    if image_id
                        img.ui.tiny.inline.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                    // if complete 
                    //     i.large.green.checkmark.icon 
                    // else 
                    i.large.circle.outline.link.icon.zoomer.mark_did(title='mark complete')
                    |#{title}
                .content 
                    // +author_info
                    // if building_number
                    //     +bu
                    |!{description}
    .ui.small.header 
        +i name='realtime-protection'
        |#{staff_activity_docs.count} staff activity
    .ui.small.list 
        each staff_activity_docs 
            .item #{task_title}
                +author_info
    .ui.inline.grey.header 
        // i.hiking.icon
        +i name='walking' classes='ui inline image'                
        |shift walks
    .ui.icon.button.log_staff_walked(title='log hourly shift walk')
        i.plus.icon    
    .ui.list
        each shift_walks
            // .item #{_when} 
            .item 
                +author_info
                if currentUser.admin_mode
                    i.remove.small.link.icon.remove_walk(title='remove walk entry')
    // if checklist_completed
    //     +i name='todo-list' classes='ui inline image'
    //     // i.big.green.checkmark.icon
    //     |shift checklist completed
    // else 
    //     a.ui.fluid.big.button(href='/shift_checklist')
    //         // i.large.tasks.icon
    //         +i name='to-do' classes='ui inline mini image'
    //         |checklist not completed

                
template(name='admin')
    .ui.header admin 
    .ui.input
        input.upload_parking(type='file')
                
    .ui.header
        +i name='line-chart'
        |global stats
    .ui.list 
        with global_stats_doc 
            .item 
                i.users.icon
                |#{user_count_total} users
            .item 
                i.checkmark.icon
                |#{checkin_count_total} check ins
            .item 
                i.users.icon
                |#{checkin_count_total} check ins
    with kiosk_doc 
        +key_value_edit key='invert_class' value='invert' label='night mode' icon='night'
        +key_value_edit key='invert_class' value='' label='day mode' icon='sun'
template(name='guest_block')
    .ui.header 
        +i name='friends'
        |guests
    .ui.selection.animated.big.list.medscroll
        each guest_docs
            .item #{name} #{_resident.username} #{_when}
                +bu
                if in_dev
                    +print_this
                a.ui.circular.icon.button(href="/guest/#{_id}")
                    i.chevron.right.large.icon
                
template(name='latest_requests')
    a.ui.header.zoomer(href="/tasks" title='view all tasks')
        +i name='wrench'
        |#{kiosk_task_docs.count}
        |latest requests
    .medscroll
        each kiosk_task_docs
            .ui.segment
                // img.ui.tiny.inline.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                .ui.inline.header #{title}
                |!{content} !{description}
                +bu
                |#{_when}
                |#{resident_username}
                a.fly_down(href="/task/#{_id}" title='view task')
                    i.large.chevron.right.link.circular.icon.zoomer
template(name='latest_notes')
    a.ui.header.zoomer(href="/posts" title='view posts')
        +i name='chat'
        |#{latest_note_docs.count} latest notes
    .medscroll
        each latest_note_docs
            .ui.segment
                if image_id
                    img.ui.tiny.inline.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                a.ui.inline.header.fly_down(href="/post/#{_id}")  !{content}
                +bu
                if currentUser.admin_mode
                    +print_this
                |#{when}
                a.ui.large.icon.basic.circular.button.fly_down(href="/post/#{_id}") 
                    i.large.chevron.right.icon
            
template(name='view_button')
    .ui.icon.button.fly_right(href="/#{model}/#{_id}")
        i.large.chevron.right.icon
            
template(name='latest_rentals')
    a.ui.header(href="/rentals" title='view rentals')
        +i name='basketball'
        |latest rentals
    .medscroll
        each rental_item_docs
            .ui.segment
                img.ui.tiny.inline.image(src="{{c.url image_id height=300 width=300 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                .ui.inline.header #{title}
                    small #{_when}
                // .ui.button.checkout_rental
                //     i.big.checkmark.icon
                //     // |checkout
                
template(name='active_checkins')
    a.ui.header.zoomer(href="/checkins" title='view checkins')
        +i name='clock'
        |#{active_checkin_docs.count} checkins today
    if subs_ready
        .ui.divided.selection.list.medscroll
            each active_checkin_docs 
                +active_checkin_doc
    else 
        i.massive.loading.refresh.icon
        
template(name='active_checkin_doc')
    .item.zoomer
        .content
            a.ui.large.basic.label.fly_down.zoomer(href="/user/#{resident_username}" title='view user') 
                | #{_resident.first_name}
                | #{_resident.last_name}
            +bu
            | #{_when}
            small {{cal_time _timestamp}}
            a.fly_down(href="/checkin/#{_id}" title=resident_user_id)
                i.circular.chevron.right.link.large.icon.zoomer
            if dev 
                i.large.code.icon(title='dev')
            if rental_id 
                +i name='clock'
            if checkin_purpose
                .ui.large.label #{checkin_purpose}
            i.sign.out.red.large.circular.link.icon.checkout.zoomer(title='check out')
            
                    
template(name='latest_activity')
    .ui.header 
        +i name='clock'
        |latest activty 
    .ui.large.list.medscroll
        each activity_docs 
            a.ui.item(href="/#{_parent_doc.model}/#{parent_id}") #{body} 
                small #{_when} by #{_author_username}
                
template(name='latest_checkins')
    .ui.segment.alpha
        .ui.header 
            +i name='history'
            |#{latest_checkin_docs.count}
            |latest checkins 
        .ui.selection.divided.list.medscroll
            each latest_checkin_docs 
                // a.item.fly_right(href="/checkin/#{_id}" title="view checkin") 
                .item
                    if active
                        i.large.green.checkmark.icon
                    else 
                        i.large.red.sign.out.alternate.icon
                    |#{_when}
                    |#{resident_username}
                    with _resident
                        +verification_label
                    
                    // +author_info
                    if currentUser.admin_mode
                        i.red.circular.remove.icon.delete_checkin
                    a.ui.circular.icon.button.zoomer.fly_right(href="/checkin/#{_id}" title='view checkin')
                        i.chevron.right.icon
        
template(name='verification_label')        
    if verified 
        .ui.image.large.label
            +i name='id-verified'
            |verified
    else 
        .ui.image.large.label
            +i name='id-not-verified'
            |unverified
        
        
                
template(name='parent_info')
    .ui.large.label
        with _parent_doc 
            +model_label
            |#{title}
                
                    
template(name='home_button')
    a.ui.big.circular.compact.image.label.fly_down(href="/#{key}")
        +i name=icon
        |#{key}
